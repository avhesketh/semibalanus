df_ell <- data.frame()
for(g in levels(as.factor(data.scores$treatment))){
df_ell <- rbind(df_ell, cbind(as.data.frame(with(data.scores[data.scores$treatment==g,],
veganCovEllipse(cov.wt(cbind(NMDS1,NMDS2),wt=rep(1/length(NMDS1),length(NMDS1)))$cov,center=c(mean(NMDS1),mean(NMDS2)))))
,group=g))
}
infauna.ordination.sa <- ggplot() +
geom_path(data=df_ell,aes(x = V1,y =V2,colour=treatment), alpha = 0.5) +
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=treatment),size=3, alpha = 0.8) + # add the point markers
geom_text(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),size = 3, alpha=0.7) +
coord_equal() +
theme_bw() +
scale_color_manual(values = c("skyblue4","tomato4")) +
geom_segment(aes(x = NMDS1, y = NMDS2, xend = mean.x, yend = mean.y, col = treatment), data = data.scores, alpha = 0.7) +
geom_text(data=data.scores,aes(x=mean.x, mean.y,label=treatment),size=4, alpha = 0.7, col = "grey20" ) +  # add the site labels
#geom_text(aes(x = 0.9, y = 0.6, label = paste("Stress = ", round(comm.infauna$stress,4))),cex = 4) +
labs(color = "Treatment", x = "Axis 1", y = "Axis 2") +
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12))
infauna.ordination.sa
infauna.ordination.sa <- ggplot() +
geom_path(data=df_ell,aes(x = NMDS1,y =NMDS2,colour=treatment), alpha = 0.5) +
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=treatment),size=3, alpha = 0.8) + # add the point markers
geom_text(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),size = 3, alpha=0.7) +
coord_equal() +
theme_bw() +
scale_color_manual(values = c("skyblue4","tomato4")) +
geom_segment(aes(x = NMDS1, y = NMDS2, xend = mean.x, yend = mean.y, col = treatment), data = data.scores, alpha = 0.7) +
geom_text(data=data.scores,aes(x=mean.x, mean.y,label=treatment),size=4, alpha = 0.7, col = "grey20" ) +  # add the site labels
#geom_text(aes(x = 0.9, y = 0.6, label = paste("Stress = ", round(comm.infauna$stress,4))),cex = 4) +
labs(color = "Treatment", x = "Axis 1", y = "Axis 2") +
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12))
infauna.ordination.sa
df_ell$treatment <- df_ell$group
infauna.ordination.sa <- ggplot() +
geom_path(data=df_ell,aes(x = NMDS1,y =NMDS2,colour=treatment), alpha = 0.5) +
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=treatment),size=3, alpha = 0.8) + # add the point markers
geom_text(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),size = 3, alpha=0.7) +
coord_equal() +
theme_bw() +
scale_color_manual(values = c("skyblue4","tomato4")) +
geom_segment(aes(x = NMDS1, y = NMDS2, xend = mean.x, yend = mean.y, col = treatment), data = data.scores, alpha = 0.7) +
geom_text(data=data.scores,aes(x=mean.x, mean.y,label=treatment),size=4, alpha = 0.7, col = "grey20" ) +  # add the site labels
#geom_text(aes(x = 0.9, y = 0.6, label = paste("Stress = ", round(comm.infauna$stress,4))),cex = 4) +
labs(color = "Treatment", x = "Axis 1", y = "Axis 2") +
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12))
infauna.ordination.sa
data.scores <- data.scores %>% group_by(treatment) %>% mutate(mean.x = mean(NMDS1), mean.y = mean(NMDS2)) %>% ungroup() %>% mutate(treatment = case_when(treatment == "1" ~ "Unshaded",treatment == "2" ~ "Shaded"))
species.scores <- as.data.frame(scores(infauna_bray, "species"))
species.scores$species <- rownames(species.scores)
veganCovEllipse<-function (cov, center = c(0, 0), scale = 1, npoints = 100)
{
theta <- (0:npoints) * 2 * pi/npoints
Circle <- cbind(cos(theta), sin(theta))
t(center + scale * t(Circle %*% chol(cov)))
}
df_ell <- data.frame()
for(g in levels(as.factor(data.scores$treatment))){
df_ell <- rbind(df_ell, cbind(as.data.frame(with(data.scores[data.scores$treatment==g,],
veganCovEllipse(cov.wt(cbind(NMDS1,NMDS2),wt=rep(1/length(NMDS1),length(NMDS1)))$cov,center=c(mean(NMDS1),mean(NMDS2)))))
,group=g))
}
df_ell$treatment <- df_ell$group
## create ggplot ordination
infauna.ordination.sa <- ggplot() +
geom_path(data=df_ell,aes(x = NMDS1,y =NMDS2,colour=treatment), alpha = 0.5) +
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=treatment),size=3, alpha = 0.8) + # add the point markers
geom_text(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),size = 3, alpha=0.7) +
coord_equal() +
theme_bw() +
scale_color_manual(values = c("skyblue4","tomato4")) +
geom_segment(aes(x = NMDS1, y = NMDS2, xend = mean.x, yend = mean.y, col = treatment), data = data.scores, alpha = 0.7) +
geom_text(data=data.scores,aes(x=mean.x, mean.y,label=treatment),size=4, alpha = 0.7, col = "grey20" ) +  # add the site labels
#geom_text(aes(x = 0.9, y = 0.6, label = paste("Stress = ", round(comm.infauna$stress,4))),cex = 4) +
labs(color = "Treatment", x = "Axis 1", y = "Axis 2") +
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12))
infauna.ordination.sa
data.scores <- as.data.frame(scores(infauna_bray))
data.scores$treatment <- infauna_factors$treatment
data.scores <- data.scores %>% group_by(treatment) %>% mutate(mean.x = mean(NMDS1), mean.y = mean(NMDS2)) %>% ungroup() %>% mutate(treatment = case_when(treatment == "1" ~ "Unshaded",treatment == "2" ~ "Shaded"))
species.scores <- as.data.frame(scores(infauna_bray, "species"))
species.scores$species <- rownames(species.scores)
veganCovEllipse<-function (cov, center = c(0, 0), scale = 1, npoints = 100)
{
theta <- (0:npoints) * 2 * pi/npoints
Circle <- cbind(cos(theta), sin(theta))
t(center + scale * t(Circle %*% chol(cov)))
}
df_ell <- data.frame()
for(g in levels(as.factor(data.scores$treatment))){
df_ell <- rbind(df_ell, cbind(as.data.frame(with(data.scores[data.scores$treatment==g,],
veganCovEllipse(cov.wt(cbind(NMDS1,NMDS2),wt=rep(1/length(NMDS1),length(NMDS1)))$cov,center=c(mean(NMDS1),mean(NMDS2)))))
,group=g))
}
df_ell$treatment <- df_ell$group
## create ggplot ordination
infauna.ordination.sa <- ggplot() +
geom_path(data=df_ell,aes(x = NMDS1,y =NMDS2,colour=treatment), alpha = 0.5) +
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=treatment),size=3, alpha = 0.8) + # add the point markers
geom_text(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),size = 3, alpha=0.7) +
coord_equal() +
theme_bw() +
scale_color_manual(values = c("skyblue4","tomato4")) +
geom_segment(aes(x = NMDS1, y = NMDS2, xend = mean.x, yend = mean.y, col = treatment), data = data.scores, alpha = 0.7) +
geom_text(data=data.scores,aes(x=mean.x, mean.y,label=treatment),size=4, alpha = 0.7, col = "grey20" ) +  # add the site labels
#geom_text(aes(x = 0.9, y = 0.6, label = paste("Stress = ", round(comm.infauna$stress,4))),cex = 4) +
labs(color = "Treatment", x = "Axis 1", y = "Axis 2") +
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12))
infauna.ordination.sa
## create ggplot ordination
infauna.ordination.sa <- ggplot() +
geom_path(data=df_ell,aes(x = NMDS1,y =NMDS2,colour=treatment, fill = treatment), alpha = 0.5) +
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=treatment),size=3, alpha = 0.8) + # add the point markers
geom_text(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),size = 3, alpha=0.7) +
coord_equal() +
theme_bw() +
scale_color_manual(values = c("skyblue4","tomato4")) +
geom_segment(aes(x = NMDS1, y = NMDS2, xend = mean.x, yend = mean.y, col = treatment), data = data.scores, alpha = 0.7) +
geom_text(data=data.scores,aes(x=mean.x, mean.y,label=treatment),size=4, alpha = 0.7, col = "grey20" ) +  # add the site labels
#geom_text(aes(x = 0.9, y = 0.6, label = paste("Stress = ", round(comm.infauna$stress,4))),cex = 4) +
labs(color = "Treatment", x = "Axis 1", y = "Axis 2") +
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12))
infauna.ordination.sa
## create ggplot ordination
infauna.ordination.sa <- ggplot() +
geom_area(data=df_ell,aes(x = NMDS1,y =NMDS2,colour=treatment, fill = treatment), alpha = 0.5) +
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=treatment),size=3, alpha = 0.8) + # add the point markers
geom_text(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),size = 3, alpha=0.7) +
coord_equal() +
theme_bw() +
scale_color_manual(values = c("skyblue4","tomato4")) +
geom_segment(aes(x = NMDS1, y = NMDS2, xend = mean.x, yend = mean.y, col = treatment), data = data.scores, alpha = 0.7) +
geom_text(data=data.scores,aes(x=mean.x, mean.y,label=treatment),size=4, alpha = 0.7, col = "grey20" ) +  # add the site labels
#geom_text(aes(x = 0.9, y = 0.6, label = paste("Stress = ", round(comm.infauna$stress,4))),cex = 4) +
labs(color = "Treatment", x = "Axis 1", y = "Axis 2") +
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12))
infauna.ordination.sa
## create ggplot ordination
infauna.ordination.sa <- ggplot() +
geom_path(data=df_ell,aes(x = NMDS1,y =NMDS2,colour=treatment), alpha = 0.5) +
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=treatment),size=3, alpha = 0.8) + # add the point markers
geom_text(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),size = 3, alpha=0.7) +
coord_equal() +
theme_bw() +
scale_color_manual(values = c("skyblue4","tomato4")) +
#geom_text(aes(x = 0.9, y = 0.6, label = paste("Stress = ", round(comm.infauna$stress,4))),cex = 4) +
labs(color = "Treatment", x = "Axis 1", y = "Axis 2") +
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12))
infauna.ordination.sa
library(ggrepel)
## create ggplot ordination
infauna.ordination.sa <- ggplot() +
geom_path(data=df_ell,aes(x = NMDS1,y =NMDS2,colour=treatment), alpha = 0.5) +
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=treatment),size=3, alpha = 0.8) + # add the point markers
geom_text_repel(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),size = 3, alpha=0.7) +
coord_equal() +
theme_bw() +
scale_color_manual(values = c("skyblue4","tomato4")) +
#geom_text(aes(x = 0.9, y = 0.6, label = paste("Stress = ", round(comm.infauna$stress,4))),cex = 4) +
labs(color = "Treatment", x = "Axis 1", y = "Axis 2") +
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12))
infauna.ordination.sa
## create ggplot ordination
infauna.ordination.sa <- ggplot() +
geom_path(data=df_ell,aes(x = NMDS1,y =NMDS2,colour=treatment), alpha = 0.5) +
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=treatment),size=3, alpha = 0.8) + # add the point markers
geom_text_repel(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),size = 3, alpha=0.7,
max.overlaps = 2, min.segment.length = 0) +
coord_equal() +
theme_bw() +
scale_color_manual(values = c("skyblue4","tomato4")) +
#geom_text(aes(x = 0.9, y = 0.6, label = paste("Stress = ", round(comm.infauna$stress,4))),cex = 4) +
labs(color = "Treatment", x = "Axis 1", y = "Axis 2") +
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12))
infauna.ordination.sa
## create ggplot ordination
infauna.ordination.sa <- ggplot() +
geom_path(data=df_ell,aes(x = NMDS1,y =NMDS2,colour=treatment), alpha = 0.5) +
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=treatment),size=3, alpha = 0.8) + # add the point markers
geom_text_repel(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),size = 3, alpha=0.7,
max.overlaps = 2, min.segment.length = 0.5) +
coord_equal() +
theme_bw() +
scale_color_manual(values = c("skyblue4","tomato4")) +
#geom_text(aes(x = 0.9, y = 0.6, label = paste("Stress = ", round(comm.infauna$stress,4))),cex = 4) +
labs(color = "Treatment", x = "Axis 1", y = "Axis 2") +
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12))
infauna.ordination.sa
## create ggplot ordination
infauna.ordination.sa <- ggplot() +
geom_path(data=df_ell,aes(x = NMDS1,y =NMDS2,colour=treatment), alpha = 0.5) +
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=treatment),size=3, alpha = 0.8) + # add the point markers
geom_text_repel(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),size = 3, alpha=0.7,
max.overlaps = 50, min.segment.length = 0.5) +
coord_equal() +
theme_bw() +
scale_color_manual(values = c("skyblue4","tomato4")) +
#geom_text(aes(x = 0.9, y = 0.6, label = paste("Stress = ", round(comm.infauna$stress,4))),cex = 4) +
labs(color = "Treatment", x = "Axis 1", y = "Axis 2") +
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12))
infauna.ordination.sa
## create ggplot ordination
infauna.ordination.sa <- ggplot() +
geom_path(data=df_ell,aes(x = NMDS1,y =NMDS2,colour=treatment), alpha = 0.5) +
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=treatment),size=3, alpha = 0.8) + # add the point markers
geom_text_repel(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),size = 3, alpha=0.7,
max.overlaps = 100, min.segment.length = 1) +
coord_equal() +
theme_bw() +
scale_color_manual(values = c("skyblue4","tomato4")) +
#geom_text(aes(x = 0.9, y = 0.6, label = paste("Stress = ", round(comm.infauna$stress,4))),cex = 4) +
labs(color = "Treatment", x = "Axis 1", y = "Axis 2") +
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12))
infauna.ordination.sa
## create ggplot ordination
infauna.ordination.sa <- ggplot() +
geom_path(data=df_ell,aes(x = NMDS1,y =NMDS2,colour=treatment), alpha = 0.5) +
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=treatment),size=3, alpha = 0.8) + # add the point markers
geom_text_repel(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),size = 3, alpha=0.7,
max.overlaps = 100, min.segment.length = 5) +
coord_equal() +
theme_bw() +
scale_color_manual(values = c("skyblue4","tomato4")) +
#geom_text(aes(x = 0.9, y = 0.6, label = paste("Stress = ", round(comm.infauna$stress,4))),cex = 4) +
labs(color = "Treatment", x = "Axis 1", y = "Axis 2") +
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12))
infauna.ordination.sa
## create ggplot ordination
infauna.ordination.sa <- ggplot() +
geom_path(data=df_ell,aes(x = NMDS1,y =NMDS2,colour=treatment), alpha = 0.5) +
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=treatment),size=3, alpha = 0.8) + # add the point markers
geom_text_repel(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),size = 3, alpha=0.7,
max.overlaps = 200, min.segment.length = 5) +
coord_equal() +
theme_bw() +
scale_color_manual(values = c("skyblue4","tomato4")) +
#geom_text(aes(x = 0.9, y = 0.6, label = paste("Stress = ", round(comm.infauna$stress,4))),cex = 4) +
labs(color = "Treatment", x = "Axis 1", y = "Axis 2") +
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12))
infauna.ordination.sa
?geom_text_repel
## create ggplot ordination
infauna.ordination.sa <- ggplot() +
geom_path(data=df_ell,aes(x = NMDS1,y =NMDS2,colour=treatment), alpha = 0.5) +
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=treatment),size=3, alpha = 0.8) + # add the point markers
geom_text_repel(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),size = 3, alpha=0.7,
max.overlaps = 200, label.padding=0.15) +
coord_equal() +
theme_bw() +
scale_color_manual(values = c("skyblue4","tomato4")) +
#geom_text(aes(x = 0.9, y = 0.6, label = paste("Stress = ", round(comm.infauna$stress,4))),cex = 4) +
labs(color = "Treatment", x = "Axis 1", y = "Axis 2") +
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12))
infauna.ordination.sa
## create ggplot ordination
infauna.ordination.sa <- ggplot() +
geom_path(data=df_ell,aes(x = NMDS1,y =NMDS2,colour=treatment), alpha = 0.5) +
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=treatment),size=3, alpha = 0.8) + # add the point markers
geom_text_repel(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),size = 3, alpha=0.7,
max.overlaps = 200, box.padding=0.15) +
coord_equal() +
theme_bw() +
scale_color_manual(values = c("skyblue4","tomato4")) +
#geom_text(aes(x = 0.9, y = 0.6, label = paste("Stress = ", round(comm.infauna$stress,4))),cex = 4) +
labs(color = "Treatment", x = "Axis 1", y = "Axis 2") +
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12))
infauna.ordination.sa
## create ggplot ordination
infauna.ordination.sa <- ggplot() +
geom_path(data=df_ell,aes(x = NMDS1,y =NMDS2,colour=treatment), alpha = 0.5) +
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=treatment),size=3, alpha = 0.8) + # add the point markers
geom_text_repel(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),size = 3, alpha=0.7,
max.overlaps = 200, box.padding=0.1) +
coord_equal() +
theme_bw() +
scale_color_manual(values = c("skyblue4","tomato4")) +
#geom_text(aes(x = 0.9, y = 0.6, label = paste("Stress = ", round(comm.infauna$stress,4))),cex = 4) +
labs(color = "Treatment", x = "Axis 1", y = "Axis 2") +
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12))
ggsave(filename = "../outputs/S1Fig1.png", infauna.ordination, dpi = 1200)
infauna.ordination.sa
## create ggplot ordination
infauna.ordination.sa <- ggplot() +
geom_path(data=df_ell,aes(x = NMDS1,y =NMDS2,colour=treatment), alpha = 0.5) +
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=treatment),size=3, alpha = 0.8) + # add the point markers
geom_text_repel(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),size = 3, alpha=0.7,
max.overlaps = 500, box.padding=0.1) +
coord_equal() +
theme_bw() +
scale_color_manual(values = c("skyblue4","tomato4")) +
#geom_text(aes(x = 0.9, y = 0.6, label = paste("Stress = ", round(comm.infauna$stress,4))),cex = 4) +
labs(color = "Treatment", x = "Axis 1", y = "Axis 2") +
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12))
infauna.ordination.sa
## create ggplot ordination
infauna.ordination.sa <- ggplot() +
geom_path(data=df_ell,aes(x = NMDS1,y =NMDS2,colour=treatment), alpha = 0.5) +
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=treatment),size=3, alpha = 0.8) + # add the point markers
geom_text_repel(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),size = 3, alpha=0.7,
max.overlaps = 500, box.padding=0.05) +
coord_equal() +
theme_bw() +
scale_color_manual(values = c("skyblue4","tomato4")) +
#geom_text(aes(x = 0.9, y = 0.6, label = paste("Stress = ", round(comm.infauna$stress,4))),cex = 4) +
labs(color = "Treatment", x = "Axis 1", y = "Axis 2") +
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12))
infauna.ordination.sa
## create ggplot ordination
infauna.ordination.sa <- ggplot() +
geom_path(data=df_ell,aes(x = NMDS1,y =NMDS2,colour=treatment), alpha = 0.5) +
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=treatment),size=3, alpha = 0.8) + # add the point markers
geom_text_repel(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),size = 3, alpha=0.7,
max.overlaps = 500, box.padding=0.02) +
coord_equal() +
theme_bw() +
scale_color_manual(values = c("skyblue4","tomato4")) +
#geom_text(aes(x = 0.9, y = 0.6, label = paste("Stress = ", round(comm.infauna$stress,4))),cex = 4) +
labs(color = "Treatment", x = "Axis 1", y = "Axis 2") +
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12))
infauna.ordination.sa
## create ggplot ordination
infauna.ordination.sa <- ggplot() +
geom_path(data=df_ell,aes(x = NMDS1,y =NMDS2,colour=treatment), alpha = 0.5) +
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=treatment),size=3, alpha = 0.8) + # add the point markers
geom_text_repel(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),size = 3, alpha=0.7,
max.overlaps = 500, box.padding=0.05, min.segment.length = 1) +
coord_equal() +
theme_bw() +
scale_color_manual(values = c("skyblue4","tomato4")) +
#geom_text(aes(x = 0.9, y = 0.6, label = paste("Stress = ", round(comm.infauna$stress,4))),cex = 4) +
labs(color = "Treatment", x = "Axis 1", y = "Axis 2") +
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12))
infauna.ordination.sa
ggsave(filename = "../outputs/S1Fig1.png", infauna.ordination.sa, dpi = 1200,
width = 3.5, height = 3.5, units = "in")
ggsave(filename = "../outputs/Fig6.png", infauna.ordination.sa, dpi = 1200,
width = 3.5, height = 3.5, units = "in")
# load packages
pkgs <- c("vegan", "vegan3d", "tidyverse", "RColorBrewer", "plotrix", "glmmTMB", "viridis", "patchwork", "magick", "ggpubr", "wesanderson")
lapply(pkgs, library, character = T)
rm(pkgs)
# load relevant data: collection info (associates number of collection with site code and collection date)
collection.info <- read_csv("../raw_data/infauna/SBHW_INFAUNA_collections.csv")
# load taxonomic data: contains information about taxonomic groupings and authorities, species codes, etc.
taxonomic.info <- read_csv("../raw_data/SBHW_taxonomic_20220105.csv") %>%  select(original_code, final_code, coarse_grouping)
# will need to read all the files for all collections ... list all the file names in this directory for reading in
sample.files <- list.files("../raw_data/infauna/community_data/")
# this loop takes a file and loads it in, capturing information about the collection number from the numeric component of the file namem, and joins these in wide format
for (file in 1: length(sample.files)){
file.name = paste("../raw_data/infauna/community_data/", sample.files[file], sep = "")
infauna <- read_csv(file.name)
# these data contain taxa at their lowest recorded taxonomic level
infauna.sum <- infauna %>% mutate(replicate = seq(1:nrow(infauna))) %>%
pivot_longer(cols = -replicate, names_to ="original_code", values_to = "abundance") %>%
left_join(taxonomic.info) %>%
select(-original_code) %>%
group_by(replicate, final_code) %>% summarize(abundance = sum(abundance)) %>%
pivot_wider(names_from = final_code, values_from = abundance) %>% mutate(file_name = sample.files[file])
# these data are for coarse taxonomic groupings
infauna.coarse <- infauna %>%
pivot_longer(cols = 1:ncol(infauna), names_to ="original_code", values_to = "abundance") %>%
left_join(taxonomic.info) %>%
select(-original_code, -final_code) %>%
group_by(coarse_grouping) %>% summarize(mean.abund = mean(abundance),se.abund = std.error(abundance)) %>% mutate(file_name = sample.files[file])
if (file == 1){
infauna.all <- infauna.sum
infauna.all.coarse <- infauna.coarse
}
if (file > 1){
infauna.all <- infauna.sum %>% full_join(infauna.all)
infauna.all.coarse <- infauna.coarse %>% full_join(infauna.all.coarse)
}
}
infauna.clean <- infauna.all %>% replace(is.na(.), 0) %>% separate(file_name, c("code", "data", "collection_number"), sep = "_") %>% select(-code, -data) %>% mutate(collection_number = as.numeric(str_remove_all(collection_number, ".csv"))) %>% left_join(collection.info)
palette <- site_info %>% select(site_code, full.pal)
# load in site information data to put points on the eventual maps
site_info <- read_csv("./raw_data/SBC_siteinformation.csv") %>%
select(site_code, latitude_degrees, longitude_degrees, mortality, infauna, angles) %>%
mutate_all(~replace_na(.,0)) %>%
mutate(shape = case_when(mortality == 1 & infauna == 0 & angles == 0 ~ "M",
mortality == 1 & infauna == 1 & angles == 0 ~ "MI",
mortality == 0 & infauna == 1 & angles == 0 ~ "I",
mortality == 0 & infauna == 0 & angles == 1 ~ "A",
mortality == 1 & infauna == 0 & angles == 1 ~ "MA",
mortality == 0 & infauna == 1 & angles == 1 ~ "IA",
mortality == 1 & infauna == 1 & angles == 1 ~ "MIA")) %>%
rename(lat = latitude_degrees, long = longitude_degrees)
palette <- site_info %>% select(site_code, full.pal)
infauna.clean <- infauna.all %>% replace(is.na(.), 0) %>% separate(file_name, c("code", "data", "collection_number"), sep = "_") %>% select(-code, -data) %>% mutate(collection_number = as.numeric(str_remove_all(collection_number, ".csv"))) %>% left_join(collection.info)
site.levels <- site_info$site_code
set.seed(20)
site_info <- site_info %>% mutate(site_code = factor(site_code, levels = site.levels),
full.pal = colorRampPalette(brewer.pal(8, "Dark2"))(17))
palette <- site_info %>% select(site_code, full.pal)
# filter by time: only collections made at the end of summer 2021 (NOT 1 and 2)
infauna.summer <- infauna.clean %>% filter(collection_number %in% 3:12) %>% left_join(palette)
col.levels <- infauna.summer$full.pal %>% unique()
site.levels <- infauna.summer$site_code %>% unique()
#get rid of everything not related to species abundance and convert to matrix for nMDS
infauna.matrix <- infauna.summer %>% ungroup() %>%
select(-collection_number, -site_code, -collection_date, -full.pal, -replicate)
# convert to matrix
infauna.matrix <- as.matrix(infauna.matrix)
# ready to analyze
comm.infauna <- metaMDS(infauna.matrix, k = 3, try = 999, autotransform = T)
# ready to analyze
comm.infauna <- metaMDS(infauna.matrix, k = 3, try = 999, autotransform = T)
stressplot(comm.infauna) # plot stress
data.scores <- as.data.frame(scores(comm.infauna))
data.scores$site_code <- infauna.summer$site_code
# load packages
pkgs <- c("vegan", "vegan3d", "tidyverse", "RColorBrewer", "plotrix", "glmmTMB", "viridis", "patchwork", "magick", "ggpubr", "wesanderson")
lapply(pkgs, library, character = T)
lapply(pkgs, library, character = T)
rm(pkgs)
infauna.clean <- infauna.all %>% replace(is.na(.), 0) %>% separate(file_name, c("code", "data", "collection_number"), sep = "_") %>% select(-code, -data) %>% mutate(collection_number = as.numeric(str_remove_all(collection_number, ".csv"))) %>% left_join(collection.info)
palette <- site_info %>% select(site_code, full.pal)
# filter by time: only collections made at the end of summer 2021 (NOT 1 and 2)
infauna.summer <- infauna.clean %>% filter(collection_number %in% 3:12) %>% left_join(palette)
col.levels <- infauna.summer$full.pal %>% unique()
site.levels <- infauna.summer$site_code %>% unique()
#get rid of everything not related to species abundance and convert to matrix for nMDS
infauna.matrix <- infauna.summer %>% ungroup() %>%
select(-collection_number, -site_code, -collection_date, -full.pal, -replicate)
# convert to matrix
infauna.matrix <- as.matrix(infauna.matrix)
data.scores <- as.data.frame(scores(comm.infauna))
data.scores$site_code <- infauna.summer$site_code
data.scores <- data.scores %>% group_by(site_code) %>% mutate(mean.x = mean(NMDS1), mean.y = mean(NMDS2)) %>% ungroup() %>% mutate(site_code = factor(site_code, levels = site.levels))
species.scores <- as.data.frame(scores(comm.infauna, "species"))
species.scores$species <- rownames(species.scores)
infauna.ordination <- ggplot() +
geom_point(data=data.scores,aes(x=NMDS1,y=NMDS2,colour=site_code),size=3, alpha = 0.8) + # add the point markers
geom_text(data=species.scores,aes(x=NMDS1,y=NMDS2,label=species),size = 3, alpha=0.7) +
coord_equal() +
theme_bw() +
scale_color_manual(values = col.levels) +
geom_segment(aes(x = NMDS1, y = NMDS2, xend = mean.x, yend = mean.y, col = site_code), data = data.scores, alpha = 0.7) +
geom_text(data=data.scores,aes(x=mean.x, mean.y,label=site_code),size=4, alpha = 0.7, col = "grey20" ) +  # add the site labels
#geom_text(aes(x = 0.9, y = 0.6, label = paste("Stress = ", round(comm.infauna$stress,4))),cex = 4) +
labs(color = "Site code", x = "Axis 1", y = "Axis 2") +
theme(axis.title = element_text(size = 14),
axis.text = element_text(size = 12),
legend.title = element_text(size = 14),
legend.text = element_text(size = 12))
infauna.ordination
ggsave(filename = "../outputs/S1Fig1.png", infauna.ordination, dpi = 1200)
